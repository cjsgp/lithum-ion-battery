clc;clear;
% load data input output
% x = getS(15,0.2);
% SOC = 0:0.1:1;
SOC_V038 = [0.9543,0.9043,0.8261,0.7565,0.6848,0.5478,0.4717,3674,0.2913,0.2326,0.1674,0.1130];
SOC_05 = [0.9435,0.9002,0.8340,0.7630,0.6913,0.5957,0.4913,0.4261,0.3413,0.2565,0.1957,0.1304];
SOC_075 = [0.9174,0.8500,0.7913,0.7130,0.6283,0.5543,0.4370,0.3196,0.2348,0.1739,0.1283,0.0891];
V_038 = [13.9630,13.5972,13.3009,13.1667,13.0833,13.0139,12.9352,12.8333,12.7639,12.6296,12.4120,12.0741];
V_05 = [13.9583,13.5556,13.2546,12.9907,12.8750,12.8009,12.7454,12.6852,12.5787,12.4398,12.2639,11.9491];
V_075 = [13.8889,13.3426,13.0185,12.8009,12.6806,12.5972,12.4981,12.4120,12.3102,12.21296296296296,12.03703703703704,11.80555555555556];
V1_038 = mapminmax(V_038);
V1_05  = mapminmax(V_05);
V1_075 = mapminmax(V_075);
I = [2.736,3.6,5.4];
I1 = mapminmax(I);

% net_038 = newff(V1_038,SOC_V038,5,{'tansig','tansig'},'traingdx');
% net_038 = newff(V1_038,SOC_V038,5,{'tansig','tansig'});
% net_05 = newff(V1_05,SOC_05,5,{'tansig','tansig'},'traingdx');
% net_05.trainParam.epochs = 1000;
% net_05.trainParam.goal = 0.001;
% net_05 = train(net_05,V1_05(1:10),SOC_05(1:10));
% O_05 = net_05(V1_05(11:12));
% E_05 = O_05 - SOC_05(11:12);
% perf_05 = perform(net_05,O_05,SOC_05(11:12));
net_075 = newff([V1_075;[0,0,0,0,0,0,0,0,0,0,0,I1(3)]],SOC_075,5,{'tansig','tansig'},'traingdx');
net_075.trainParam.epochs = 1000;
net_075.trainParam.goal = 0.001;
net_075 = train(net_075,[V1_075(1:10);[0,0,0,0,0,0,0,0,0,I1(3)]],SOC_075(1:10));
O_075 = net_075([V1_075(11:12);[0,I1(3)]]);
E_075 = O_075 - SOC_075(11:12);
perf_075 = perform(net_075,O_075,SOC_075(11:12));
% net_038.trainParam.epochs = 1000;
% net_038.trainParam.goal = 0.001;
% net_038 = train(net_038,V1_038(1:10),SOC_V038(1:10));
% O_038 = net_038(V1_038(11:12));
% E_038 = O_038 - SOC_V038(11:12);
% perf_038 = perform(net_038,O_038,SOC_V038(11:12));
% X=-1:0.1:1; 
% D=[-0.9602 -0.5770 -0.0729 0.3771 0.6405 0.6600 0.4609... 
%     0.1336 -0.2013 -0.4344 -0.5000 -0.3930 -0.1647 -.0988... 
%     0.3072 0.3960 0.3449 0.1816 -0.312 -0.2189 -0.3201];
% 
% % % figure; plot(X,D,'*'); %绘制原始数据分布图 
% net = newff(X,D,[10,2]); 
% % net.trainParam.epochs = 100; %训练的最大次数 
% % net.trainParam.goal = 0.005; %全局最小误差 
% net = train(net,X,D);
% O = net(X);
% error = O - D;
% perf = perform(net,O,D);
% figure; 
% plot(X,D,'*',X,O); %绘制训练后得到的结果和误差曲线 
% V = net.iw{1,1};%输入层到中间层权值 
% theta1 = net.b{1};%中间层各神经元阈值 
% W = net.lw{2,1};%中间层到输出层权值 
% theta2 = net.b{2};%输出层各神经元阈值

% y = [4.18928734377277,4.18849961174195,3.97975005626919,3.95983691278347,3.94434254878437,3.93123954483280,3.91983972999279,3.90924468912547,3.90013364256146,3.89184099933983,3.88405390364093,3.87692093108895,3.87038827891431,3.86405509906876,3.85824934775316,3.85286792762829,3.84754069753230,3.84270953087747,3.83799426834535,3.83353595742690,3.82932297269495,3.82530124743426,3.82161561272937,3.81760574890684,3.81405433310082,3.81057748871248,3.80701231421135,3.80367549499365,3.80014567701513,3.79678507347029,3.79347605347688,3.79002755936518,3.78663554483064,3.78324905164817,3.77963505956658,3.77618743591725,3.77263073030684,3.76915359999022,3.76560483074165,3.76197428971618,3.75827189338592,3.75467425672702,3.75101352705434,3.74739029070847,3.74361588633004,3.74010533348277,3.73628513300481,3.73248454601859,3.72891381458954,3.72511682763445,3.72156660064991,3.71775946098580,3.71431717171932,3.71074333138497,3.70727667150169,3.70381326002740,3.70032409091880,3.69704730167888,3.69382299545879,3.69078804649074,3.68732230571973,3.68397720660471,3.68101046769181,3.67779005756744,3.67462024117927,3.67138411072842,3.66833625044132,3.66526236244704,3.66221837721972,3.65938471320307,3.65614134289258,3.65320937832333,3.65019018754525,3.64734969629069,3.64421113879439,3.64152769103022,3.63855519977511,3.63579123273613,3.63265780486001,3.63011106092396,3.62726113018573,3.62455096542283,3.62163781540165,3.61882642480647,3.61597462712543,3.61340622199043,3.61073443136913,3.60811068745286,3.60541645678397,3.60273097754715,3.60017199455277,3.59732177378879,3.59484737604784,3.59201828955502,3.58960034060604,3.58709764508488,3.58446250864800,3.58191082655317,3.57958797812627,3.57722215567579,3.57474277329173,3.57232014097335,3.56992304824728,3.56740829342191,3.56510573241852,3.56276191402604,3.56034440149040,3.55793471084741,3.55563291916001,3.55355971954511,3.55113350623606,3.54884561573288,3.54658433378757,3.54443562134606,3.54233669114787,3.54003648629556,3.53798765581535,3.53587815050208,3.53380911724839,3.53166610721250,3.52960649924894,3.52759067539939,3.52546542038673,3.52338930714424,3.52152178194007,3.51950049326076,3.51746660131458,3.51552569903262,3.51351686584055,3.51187997266733,3.50982398054807,3.50781323960387,3.50602723668541,3.50410297360791,3.50232992302415,3.50065003448173,3.49872694505806,3.49712551271490,3.49526224837658,3.49363229934626,3.49176250022882,3.49007452560106,3.48829719614792,3.48669612459431,3.48505710849724,3.48329449965465,3.48169968468671,3.47990527517980,3.47834903148080,3.47676224186686,3.47515039668088,3.47363031805576,3.47204898764706,3.47028491084364,3.46887960435036,3.46721286688330,3.46556203826578,3.46409051341502,3.46255355927196,3.46085976891672,3.45949941998622,3.45803927836566,3.45632988060385,3.45469855692506,3.45307796582439,3.45172061329740,3.45022047857064,3.44869605738198,3.44697209801232,3.44554311753611,3.44415301373199,3.44245843439954,3.44083764183313,3.43923723116945,3.43775989508169,3.43600098667391,3.43440467542439,3.43293632719079,3.43134045374317,3.42975122502446,3.42806194800927,3.42671690094339,3.42495309852077,3.42331751934447,3.42178405264589,3.42018615740882,3.41839748350519,3.41678465134528,3.41514243867250,3.41355316448020,3.41183733482934,3.41004683192535,3.40831806580909,3.40651606518421,3.40473517286677,3.40312405034518,3.40149112512683,3.39965395100148,3.39771445401861,3.39582725314166,3.39412647987036,3.39240024151420,3.39022039209444,3.38831024101147,3.38641824076118,3.38452402882492,3.38238907150517,3.38047553572576,3.37830606916901,3.37633732656094,3.37428005540067,3.37210994560238,3.36999448429980,3.36763535503658,3.36535689181451,3.36290185395437,3.36068127598343,3.35818635173257,3.35554160452890,3.35313029658103,3.35042067915500,3.34778900203329,3.34499790923190,3.34212044335099,3.33922313841652,3.33630312460236,3.33317495048465,3.32988533800098,3.32668295963043,3.32310183716237,3.31960009577445,3.31593875086516,3.31196263448038,3.30790422013978,3.30348114285240,3.29901300849497,3.29444184065582,3.28966162073673,3.28449024548626,3.27917539315429,3.27350750759932,3.26761241159615,3.26133675940198,3.25475696847947,3.24784395435703,3.24077228214170,3.23330473458941,3.22554038040644,3.21710605446233,3.20853246391760,3.19935929304775,3.18970517080642,3.17991788867071,3.16943743087553,3.15861307701600,3.14691457442849,3.13496979608435,3.12236310260217,3.10904772720891,3.09520658558889,3.08092635357187,3.06596141344858,3.05065776275760,3.03492932877569,3.01790262641127,3.00071979152579,2.98250803299858,2.96320968891175,2.94225892149824,2.91844134604380,2.89145649499820,2.86013971910007,2.82338330867237,2.77905884805212,2.72538122858966,2.66003194928293];
% x = [0,9.43800000000000,19.5630000000000,28.9220000000000,38.3130000000000,47.6410000000000,57.0310000000000,66.3910000000000,75.7350000000000,85.1100000000000,94.4690000000000,103.750000000000,113.078000000000,122.438000000000,131.750000000000,141.094000000000,150.500000000000,159.828000000000,169.172000000000,178.610000000000,187.969000000000,197.344000000000,206.656000000000,216,225.391000000000,234.781000000000,244.172000000000,253.531000000000,262.922000000000,272.313000000000,281.641000000000,291.016000000000,300.360000000000,309.735000000000,319.078000000000,328.453000000000,337.828000000000,347.156000000000,356.563000000000,365.953000000000,375.328000000000,384.688000000000,394.078000000000,403.438000000000,412.828000000000,422.203000000000,431.547000000000,440.891000000000,450.235000000000,459.610000000000,469,478.375000000000,487.735000000000,497.094000000000,506.422000000000,515.781000000000,525.203000000000,534.547000000000,543.953000000000,553.297000000000,562.656000000000,572.047000000000,581.406000000000,590.797000000000,600.141000000000,609.516000000000,618.906000000000,628.266000000000,637.610000000000,647.031000000000,656.422000000000,665.813000000000,675.281000000000,684.672000000000,694.016000000000,703.391000000000,712.750000000000,722.078000000000,731.516000000000,740.860000000000,750.219000000000,759.547000000000,768.860000000000,778.219000000000,787.594000000000,796.969000000000,806.344000000000,815.703000000000,825.047000000000,834.500000000000,843.938000000000,853.297000000000,862.672000000000,872.031000000000,881.438000000000,890.797000000000,900.172000000000,909.531000000000,918.844000000000,928.188000000000,937.594000000000,946.969000000000,956.344000000000,965.703000000000,975.031000000000,984.391000000000,993.813000000000,1003.15600000000,1012.53100000000,1021.89100000000,1031.31300000000,1040.67200000000,1049.98500000000,1059.34400000000,1068.70300000000,1078.11000000000,1087.45300000000,1096.86000000000,1106.25000000000,1115.61000000000,1125,1134.37500000000,1143.78100000000,1153.14100000000,1162.54700000000,1171.90600000000,1181.32800000000,1190.71900000000,1200.09400000000,1209.45300000000,1218.84400000000,1228.21900000000,1237.56300000000,1246.89100000000,1256.32800000000,1265.67200000000,1275.03100000000,1284.39100000000,1293.70300000000,1303.04700000000,1312.36000000000,1321.73500000000,1331.09400000000,1340.45300000000,1349.79700000000,1359.17200000000,1368.53100000000,1377.92200000000,1387.29700000000,1396.64100000000,1406.01600000000,1415.37500000000,1424.75000000000,1434.09400000000,1443.45300000000,1452.84400000000,1462.17200000000,1471.57800000000,1480.96900000000,1490.36000000000,1499.68800000000,1509.04700000000,1518.40600000000,1527.76600000000,1537.15600000000,1546.50000000000,1555.93800000000,1565.29700000000,1574.70300000000,1584.07800000000,1593.40600000000,1602.76600000000,1612.12500000000,1621.48500000000,1630.84400000000,1640.20300000000,1649.54700000000,1658.90600000000,1668.28100000000,1677.65600000000,1687.06300000000,1696.45300000000,1705.81300000000,1715.15600000000,1724.48500000000,1733.87500000000,1743.23500000000,1752.64100000000,1761.98500000000,1771.34400000000,1780.68800000000,1790.09400000000,1799.46900000000,1808.87500000000,1818.23500000000,1827.57800000000,1836.96900000000,1846.32800000000,1855.68800000000,1865.04700000000,1874.43800000000,1883.82800000000,1893.21900000000,1902.59400000000,1911.95300000000,1921.28100000000,1930.64100000000,1940,1949.36000000000,1958.78100000000,1968.17200000000,1977.51600000000,1986.89100000000,1996.25000000000,2005.61000000000,2014.96900000000,2024.29700000000,2033.64100000000,2042.98500000000,2052.39100000000,2061.79700000000,2071.14100000000,2080.54700000000,2089.93800000000,2099.28100000000,2108.64100000000,2118.01600000000,2127.34400000000,2136.71900000000,2146.07800000000,2155.46900000000,2164.81300000000,2174.15600000000,2183.54700000000,2192.96900000000,2202.26600000000,2211.70300000000,2221.06300000000,2230.40600000000,2239.73500000000,2249.12500000000,2258.54700000000,2267.84400000000,2277.26600000000,2286.64100000000,2295.96900000000,2305.32800000000,2314.76600000000,2324.14100000000,2333.51600000000,2342.86000000000,2352.25000000000,2361.64100000000,2371,2380.37500000000,2389.75000000000,2399.07800000000,2408.43800000000,2417.79700000000,2427.14100000000,2436.50000000000,2445.86000000000,2455.23500000000,2464.56300000000,2473.98500000000,2483.36000000000,2492.68800000000,2502.07800000000,2511.43800000000,2520.96900000000,2530.46900000000,2539.92200000000,2549.39100000000,2558.92200000000,2568.45300000000,2577.93800000000];
% plot(x,y,'o');
% xx = 0:9.45:2600;
% yy = [4.18928734377277,4.18849961174195,3.97975005626919,3.95983691278347,3.94434254878437,3.93123954483280,3.91983972999279,3.90924468912547,3.90013364256146,3.89184099933983,3.88405390364093,3.87692093108895,3.87038827891431,3.86405509906876,3.85824934775316,3.85286792762829,3.84754069753230,3.84270953087747,3.83799426834535,3.83353595742690,3.82932297269495,3.82530124743426,3.82161561272937,3.81760574890684,3.81405433310082,3.81057748871248,3.80701231421135,3.80367549499365,3.80014567701513,3.79678507347029,3.79347605347688,3.79002755936518,3.78663554483064,3.78324905164817,3.77963505956658,3.77618743591725,3.77263073030684,3.76915359999022,3.76560483074165,3.76197428971618,3.75827189338592,3.75467425672702,3.75101352705434,3.74739029070847,3.74361588633004,3.74010533348277,3.73628513300481,3.73248454601859,3.72891381458954,3.72511682763445,3.72156660064991,3.71775946098580,3.71431717171932,3.71074333138497,3.70727667150169,3.70381326002740,3.70032409091880,3.69704730167888,3.69382299545879,3.69078804649074,3.68732230571973,3.68397720660471,3.68101046769181,3.67779005756744,3.67462024117927,3.67138411072842,3.66833625044132,3.66526236244704,3.66221837721972,3.65938471320307,3.65614134289258,3.65320937832333,3.65019018754525,3.64734969629069,3.64421113879439,3.64152769103022,3.63855519977511,3.63579123273613,3.63265780486001,3.63011106092396,3.62726113018573,3.62455096542283,3.62163781540165,3.61882642480647,3.61597462712543,3.61340622199043,3.61073443136913,3.60811068745286,3.60541645678397,3.60273097754715,3.60017199455277,3.59732177378879,3.59484737604784,3.59201828955502,3.58960034060604,3.58709764508488,3.58446250864800,3.58191082655317,3.57958797812627,3.57722215567579,3.57474277329173,3.57232014097335,3.56992304824728,3.56740829342191,3.56510573241852,3.56276191402604,3.56034440149040,3.55793471084741,3.55563291916001,3.55355971954511,3.55113350623606,3.54884561573288,3.54658433378757,3.54443562134606,3.54233669114787,3.54003648629556,3.53798765581535,3.53587815050208,3.53380911724839,3.53166610721250,3.52960649924894,3.52759067539939,3.52546542038673,3.52338930714424,3.52152178194007,3.51950049326076,3.51746660131458,3.51552569903262,3.51351686584055,3.51187997266733,3.50982398054807,3.50781323960387,3.50602723668541,3.50410297360791,3.50232992302415,3.50065003448173,3.49872694505806,3.49712551271490,3.49526224837658,3.49363229934626,3.49176250022882,3.49007452560106,3.48829719614792,3.48669612459431,3.48505710849724,3.48329449965465,3.48169968468671,3.47990527517980,3.47834903148080,3.47676224186686,3.47515039668088,3.47363031805576,3.47204898764706,3.47028491084364,3.46887960435036,3.46721286688330,3.46556203826578,3.46409051341502,3.46255355927196,3.46085976891672,3.45949941998622,3.45803927836566,3.45632988060385,3.45469855692506,3.45307796582439,3.45172061329740,3.45022047857064,3.44869605738198,3.44697209801232,3.44554311753611,3.44415301373199,3.44245843439954,3.44083764183313,3.43923723116945,3.43775989508169,3.43600098667391,3.43440467542439,3.43293632719079,3.43134045374317,3.42975122502446,3.42806194800927,3.42671690094339,3.42495309852077,3.42331751934447,3.42178405264589,3.42018615740882,3.41839748350519,3.41678465134528,3.41514243867250,3.41355316448020,3.41183733482934,3.41004683192535,3.40831806580909,3.40651606518421,3.40473517286677,3.40312405034518,3.40149112512683,3.39965395100148,3.39771445401861,3.39582725314166,3.39412647987036,3.39240024151420,3.39022039209444,3.38831024101147,3.38641824076118,3.38452402882492,3.38238907150517,3.38047553572576,3.37830606916901,3.37633732656094,3.37428005540067,3.37210994560238,3.36999448429980,3.36763535503658,3.36535689181451,3.36290185395437,3.36068127598343,3.35818635173257,3.35554160452890,3.35313029658103,3.35042067915500,3.34778900203329,3.34499790923190,3.34212044335099,3.33922313841652,3.33630312460236,3.33317495048465,3.32988533800098,3.32668295963043,3.32310183716237,3.31960009577445,3.31593875086516,3.31196263448038,3.30790422013978,3.30348114285240,3.29901300849497,3.29444184065582,3.28966162073673,3.28449024548626,3.27917539315429,3.27350750759932,3.26761241159615,3.26133675940198,3.25475696847947,3.24784395435703,3.24077228214170,3.23330473458941,3.22554038040644,3.21710605446233,3.20853246391760,3.19935929304775,3.18970517080642,3.17991788867071,3.16943743087553,3.15861307701600,3.14691457442849,3.13496979608435,3.12236310260217,3.10904772720891,3.09520658558889,3.08092635357187,3.06596141344858,3.05065776275760,3.03492932877569,3.01790262641127,3.00071979152579,2.98250803299858,2.96320968891175,2.94225892149824,2.91844134604380,2.89145649499820,2.86013971910007,2.82338330867237,2.77905884805212,2.72538122858966,2.66003194928293];
% c0=[0 0 0 0 0 0 0 0 0 0 0 0];
% [d,resnorm] = lsqcurvefit ('fun', c0, xx, yy) ;
% % %以计算出的 c为初值进行迭代;
% y1 = 3.9235 + d(1) * xx * 1.0156+d(2)*(xx / 1.1112).^2+d(3)*(xx).^3+d(4)*(xx / 1.4334).^4+d(5)*(xx/1.4334).^5+d(6)*(1-exp(-d(7).*xx))+d(8)*(1-exp(-d(9).*xx))+d(10)+d(11)*exp(-d(12)*xx * 1.5);
% plot(x,y,'o',xx,y1,'r');
% legend('实验数据','拟合数据');

% x = [0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1];
% y = [3.1,3.27,3.81,4.5,5.18,6,7.05,8.56,9.69,11.25,13.17];
% xdata=0:0.1:1;
% ydata=[3.1 3.27 3.81 4.5 5.18 6,7.05,8.56,9.69,11.25,13.17];
% X0 = [0 0 0];
% [X,resnorm] = lsqcurvefit(@fun,X0,xdata,ydata);
% Y = X(1) * exp(xdata) + X(2) * xdata.^2 + X(3) * xdata.^3;
% plot(x,y,'o',xdata,Y,'r');
% legend('实验数据','拟合数据');
